From 1e44c245ebcc4ac8169f6a81797d3b6400ba8fdf Mon Sep 17 00:00:00 2001
From: Don Gunn <dongunn@hotmail.com>
Date: Fri, 8 Sep 2023 09:39:57 -0700
Subject: [PATCH] updated ddr4 timing for the Kingston 3200MTS memory

---
 board/freescale/imx8mp_evk/ddr4_timing.c | 152 +++++++++++------------
 1 file changed, 76 insertions(+), 76 deletions(-)
 mode change 100644 => 100755 board/freescale/imx8mp_evk/ddr4_timing.c

diff --git a/board/freescale/imx8mp_evk/ddr4_timing.c b/board/freescale/imx8mp_evk/ddr4_timing.c
old mode 100644
new mode 100755
index 50a6f10294..823a5ec355
--- a/board/freescale/imx8mp_evk/ddr4_timing.c
+++ b/board/freescale/imx8mp_evk/ddr4_timing.c
@@ -18,41 +18,41 @@ struct dram_cfg_param ddr_ddrc_cfg[] = {
 	/** Initialize DDRC registers **/
 	{ 0x3d400304, 0x1 },
 	{ 0x3d400030, 0x1 },
-	{ 0x3d400000, 0x81040010 },
+	{ 0x3d400000, 0xa1040010 },
 	{ 0x3d400030, 0xaa },
 	{ 0x3d400034, 0x221306 },
 	{ 0x3d400050, 0x210070 },
 	{ 0x3d400054, 0x10008 },
 	{ 0x3d400060, 0x0 },
-	{ 0x3d400064, 0x4900d2 },
+	{ 0x3d400064, 0xc30118 },
 	{ 0x3d4000c0, 0x0 },
 	{ 0x3d4000c4, 0x1000 },
 	{ 0x3d400070, 0x3027f90 },
 	{ 0x3d400074, 0x790 },
-	{ 0x3d4000d0, 0xc0030126 },
-	{ 0x3d4000d4, 0x770000 },
-	{ 0x3d4000dc, 0x8500503 },
-	{ 0x3d4000e0, 0x180200 },
+	{ 0x3d4000d0, 0xc0030188 },
+	{ 0x3d4000d4, 0x9e0000 },
+	{ 0x3d4000dc, 0xc500501 },
+	{ 0x3d4000e0, 0x280400 },
 	{ 0x3d4000e4, 0x110000 },
 	{ 0x3d4000e8, 0x2000600 },
-	{ 0x3d4000ec, 0x810 },
+	{ 0x3d4000ec, 0x1010 },
 	{ 0x3d4000f0, 0x20 },
 	{ 0x3d4000f4, 0xec7 },
-	{ 0x3d400100, 0x11121413 },
-	{ 0x3d400104, 0x4051c },
-	{ 0x3d400108, 0x60b080d },
+	{ 0x3d400100, 0x1618361a },
+	{ 0x3d400104, 0x50625 },
+	{ 0x3d400108, 0x80b0610 },
 	{ 0x3d40010c, 0x400c },
-	{ 0x3d400110, 0x903040a },
-	{ 0x3d400114, 0x6060403 },
-	{ 0x3d40011c, 0x606 },
-	{ 0x3d400120, 0x5050d08 },
-	{ 0x3d400124, 0x2040a },
-	{ 0x3d40012c, 0x1409010e },
+	{ 0x3d400110, 0xb04060c },
+	{ 0x3d400114, 0x8080504 },
+	{ 0x3d40011c, 0x808 },
+	{ 0x3d400120, 0x6060d0a },
+	{ 0x3d400124, 0x2050c },
+	{ 0x3d40012c, 0x160b010e },
 	{ 0x3d400130, 0x8 },
 	{ 0x3d40013c, 0x0 },
 	{ 0x3d400180, 0x1000040 },
-	{ 0x3d400184, 0x493e },
-	{ 0x3d400190, 0x3918207 },
+	{ 0x3d400184, 0x61a8 },
+	{ 0x3d400190, 0x391820b },
 	{ 0x3d400194, 0x2020303 },
 	{ 0x3d400198, 0x7f04011 },
 	{ 0x3d40019c, 0xb0 },
@@ -60,7 +60,7 @@ struct dram_cfg_param ddr_ddrc_cfg[] = {
 	{ 0x3d4001a4, 0x48005a },
 	{ 0x3d4001a8, 0x80000000 },
 	{ 0x3d4001b0, 0x1 },
-	{ 0x3d4001b4, 0x1107 },
+	{ 0x3d4001b4, 0x110b },
 	{ 0x3d4001b8, 0x4 },
 	{ 0x3d4001c0, 0x1 },
 	{ 0x3d4001c4, 0x0 },
@@ -73,7 +73,7 @@ struct dram_cfg_param ddr_ddrc_cfg[] = {
 	{ 0x3d400218, 0x7070707 },
 	{ 0x3d40021c, 0xf0f },
 	{ 0x3d400220, 0x3f01 },
-	{ 0x3d400240, 0x6000628 },
+	{ 0x3d400240, 0x6000618 },
 	{ 0x3d400244, 0x1323 },
 	{ 0x3d400250, 0x1a05 },
 	{ 0x3d400254, 0x1f },
@@ -89,12 +89,12 @@ struct dram_cfg_param ddr_ddrc_cfg[] = {
 	{ 0x3d40049c, 0x1100e07 },
 	{ 0x3d4004a0, 0xc8012c },
 	{ 0x3d402050, 0x210070 },
-	{ 0x3d402064, 0x20005e },
-	{ 0x3d4020dc, 0x40503 },
+	{ 0x3d402064, 0x40005e },
+	{ 0x3d4020dc, 0x40501 },
 	{ 0x3d4020e0, 0x0 },
 	{ 0x3d4020e8, 0x2000600 },
 	{ 0x3d4020ec, 0x10 },
-	{ 0x3d402100, 0xb080909 },
+	{ 0x3d402100, 0xb081209 },
 	{ 0x3d402104, 0x2020d },
 	{ 0x3d402108, 0x5050309 },
 	{ 0x3d40210c, 0x400c },
@@ -144,7 +144,7 @@ struct dram_cfg_param ddr_ddrphy_cfg[] = {
 	{ 0x7055, 0x355 },
 	{ 0x8055, 0x355 },
 	{ 0x9055, 0x355 },
-	{ 0x200c5, 0xa },
+	{ 0x200c5, 0x19 },
 	{ 0x1200c5, 0x6 },
 	{ 0x2002e, 0x2 },
 	{ 0x12002e, 0x1 },
@@ -152,7 +152,7 @@ struct dram_cfg_param ddr_ddrphy_cfg[] = {
 	{ 0x2003a, 0x2 },
 	{ 0x120024, 0x8 },
 	{ 0x2003a, 0x2 },
-	{ 0x20056, 0x6 },
+	{ 0x20056, 0x7 },
 	{ 0x120056, 0xa },
 	{ 0x1004d, 0x1a },
 	{ 0x1014d, 0x1a },
@@ -170,36 +170,36 @@ struct dram_cfg_param ddr_ddrphy_cfg[] = {
 	{ 0x11214d, 0x1a },
 	{ 0x11304d, 0x1a },
 	{ 0x11314d, 0x1a },
-	{ 0x10049, 0x69a },
-	{ 0x10149, 0x69a },
-	{ 0x11049, 0x69a },
-	{ 0x11149, 0x69a },
-	{ 0x12049, 0x69a },
-	{ 0x12149, 0x69a },
-	{ 0x13049, 0x69a },
-	{ 0x13149, 0x69a },
-	{ 0x110049, 0x69a },
-	{ 0x110149, 0x69a },
-	{ 0x111049, 0x69a },
-	{ 0x111149, 0x69a },
-	{ 0x112049, 0x69a },
-	{ 0x112149, 0x69a },
-	{ 0x113049, 0x69a },
-	{ 0x113149, 0x69a },
-	{ 0x43, 0x63 },
-	{ 0x1043, 0x63 },
-	{ 0x2043, 0x63 },
-	{ 0x3043, 0x63 },
-	{ 0x4043, 0x63 },
-	{ 0x5043, 0x63 },
-	{ 0x6043, 0x63 },
-	{ 0x7043, 0x63 },
-	{ 0x8043, 0x63 },
-	{ 0x9043, 0x63 },
+	{ 0x10049, 0xeba },
+	{ 0x10149, 0xeba },
+	{ 0x11049, 0xeba },
+	{ 0x11149, 0xeba },
+	{ 0x12049, 0xeba },
+	{ 0x12149, 0xeba },
+	{ 0x13049, 0xeba },
+	{ 0x13149, 0xeba },
+	{ 0x110049, 0xeba },
+	{ 0x110149, 0xeba },
+	{ 0x111049, 0xeba },
+	{ 0x111149, 0xeba },
+	{ 0x112049, 0xeba },
+	{ 0x112149, 0xeba },
+	{ 0x113049, 0xeba },
+	{ 0x113149, 0xeba },
+	{ 0x43, 0xe7 },
+	{ 0x1043, 0xe7 },
+	{ 0x2043, 0xe7 },
+	{ 0x3043, 0xe7 },
+	{ 0x4043, 0xe7 },
+	{ 0x5043, 0xe7 },
+	{ 0x6043, 0xe7 },
+	{ 0x7043, 0xe7 },
+	{ 0x8043, 0xe7 },
+	{ 0x9043, 0xe7 },
 	{ 0x20018, 0x5 },
 	{ 0x20075, 0x2 },
 	{ 0x20050, 0x0 },
-	{ 0x20008, 0x258 },
+	{ 0x20008, 0x320 },
 	{ 0x120008, 0x10a },
 	{ 0x20088, 0x9 },
 	{ 0x200b2, 0x248 },
@@ -971,9 +971,9 @@ struct dram_cfg_param ddr_ddrphy_trained_csr[] = {
 /* P0 message block paremeter for training firmware */
 struct dram_cfg_param ddr_fsp0_cfg[] = {
 	{ 0xd0000, 0x0 },
-	{ 0x54003, 0x960 },
+	{ 0x54003, 0xc80 },
 	{ 0x54004, 0x2 },
-	{ 0x54005, 0x3030 },
+	{ 0x54005, 0x2230 },
 	{ 0x54006, 0x25b },
 	{ 0x54007, 0x2000 },
 	{ 0x54008, 0x101 },
@@ -981,13 +981,13 @@ struct dram_cfg_param ddr_fsp0_cfg[] = {
 	{ 0x5400c, 0xc8 },
 	{ 0x5400d, 0x100 },
 	{ 0x54012, 0x1 },
-	{ 0x5402f, 0x850 },
-	{ 0x54030, 0x503 },
-	{ 0x54031, 0x18 },
-	{ 0x54032, 0x200 },
+	{ 0x5402f, 0xc50 },
+	{ 0x54030, 0x501 },
+	{ 0x54031, 0x28 },
+	{ 0x54032, 0x400 },
 	{ 0x54033, 0x200 },
 	{ 0x54034, 0x600 },
-	{ 0x54035, 0x810 },
+	{ 0x54035, 0x1010 },
 	{ 0x54036, 0x101 },
 	{ 0x5403f, 0x1221 },
 	{ 0x541fc, 0x100 },
@@ -1001,7 +1001,7 @@ struct dram_cfg_param ddr_fsp1_cfg[] = {
 	{ 0x54002, 0x1 },
 	{ 0x54003, 0x42a },
 	{ 0x54004, 0x2 },
-	{ 0x54005, 0x3030 },
+	{ 0x54005, 0x2230 },
 	{ 0x54006, 0x25b },
 	{ 0x54007, 0x2000 },
 	{ 0x54008, 0x101 },
@@ -1010,7 +1010,7 @@ struct dram_cfg_param ddr_fsp1_cfg[] = {
 	{ 0x5400d, 0x100 },
 	{ 0x54012, 0x1 },
 	{ 0x5402f, 0x4 },
-	{ 0x54030, 0x503 },
+	{ 0x54030, 0x501 },
 	{ 0x54033, 0x200 },
 	{ 0x54034, 0x600 },
 	{ 0x54035, 0x10 },
@@ -1024,9 +1024,9 @@ struct dram_cfg_param ddr_fsp1_cfg[] = {
 /* P0 2D message block paremeter for training firmware */
 struct dram_cfg_param ddr_fsp0_2d_cfg[] = {
 	{ 0xd0000, 0x0 },
-	{ 0x54003, 0x960 },
+	{ 0x54003, 0xc80 },
 	{ 0x54004, 0x2 },
-	{ 0x54005, 0x3030 },
+	{ 0x54005, 0x2230 },
 	{ 0x54006, 0x25b },
 	{ 0x54007, 0x2000 },
 	{ 0x54008, 0x101 },
@@ -1035,13 +1035,13 @@ struct dram_cfg_param ddr_fsp0_2d_cfg[] = {
 	{ 0x5400d, 0x100 },
 	{ 0x5400e, 0x1f7f },
 	{ 0x54012, 0x1 },
-	{ 0x5402f, 0x850 },
-	{ 0x54030, 0x503 },
-	{ 0x54031, 0x18 },
-	{ 0x54032, 0x200 },
+	{ 0x5402f, 0xc50 },
+	{ 0x54030, 0x501 },
+	{ 0x54031, 0x28 },
+	{ 0x54032, 0x400 },
 	{ 0x54033, 0x200 },
 	{ 0x54034, 0x600 },
-	{ 0x54035, 0x810 },
+	{ 0x54035, 0x1010 },
 	{ 0x54036, 0x101 },
 	{ 0x5403f, 0x1221 },
 	{ 0x541fc, 0x100 },
@@ -1222,9 +1222,9 @@ struct dram_cfg_param ddr_phy_pie[] = {
 	{ 0xd00e7, 0x400 },
 	{ 0x90017, 0x0 },
 	{ 0x90026, 0x2a },
-	{ 0x2000b, 0x2a3 },
-	{ 0x2000c, 0x96 },
-	{ 0x2000d, 0x5dc },
+	{ 0x2000b, 0x384 },
+	{ 0x2000c, 0xc8 },
+	{ 0x2000d, 0x7d0 },
 	{ 0x2000e, 0x2c },
 	{ 0x12000b, 0x12b },
 	{ 0x12000c, 0x42 },
@@ -1246,8 +1246,8 @@ struct dram_cfg_param ddr_phy_pie[] = {
 
 struct dram_fsp_msg ddr_dram_fsp_msg[] = {
 	{
-		/* P0 2400mts 1D */
-		.drate = 2400,
+		/* P0 3200mts 1D */
+		.drate = 3200,
 		.fw_type = FW_1D_IMAGE,
 		.fsp_cfg = ddr_fsp0_cfg,
 		.fsp_cfg_num = ARRAY_SIZE(ddr_fsp0_cfg),
@@ -1260,8 +1260,8 @@ struct dram_fsp_msg ddr_dram_fsp_msg[] = {
 		.fsp_cfg_num = ARRAY_SIZE(ddr_fsp1_cfg),
 	},
 	{
-		/* P0 2400mts 2D */
-		.drate = 2400,
+		/* P0 3200mts 2D */
+		.drate = 3200,
 		.fw_type = FW_2D_IMAGE,
 		.fsp_cfg = ddr_fsp0_2d_cfg,
 		.fsp_cfg_num = ARRAY_SIZE(ddr_fsp0_2d_cfg),
@@ -1280,6 +1280,6 @@ struct dram_timing_info dram_timing = {
 	.ddrphy_trained_csr_num = ARRAY_SIZE(ddr_ddrphy_trained_csr),
 	.ddrphy_pie = ddr_phy_pie,
 	.ddrphy_pie_num = ARRAY_SIZE(ddr_phy_pie),
-	.fsp_table = { 2400, 1066, },
+	.fsp_table = { 3200, 1066, },
 };
 
